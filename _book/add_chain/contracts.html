
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Cross-Chain Smart Contract · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-flexible-linkcard/flexible-linkcard.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-emphasize/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-hqbook/theme.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="registration.html" />
    
    
    <link rel="prev" href="readme.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="header-inner">
        <!-- LOGO -->
        <div class="logo">
            <img src="" alt="logo">
        </div>
        <span class="title"></span>

        <!-- Search -->
        
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>


        <!-- Nav -->
        <ul class="header-nav">
            <li>
                <a href="https://poly.network/" target="_blank">Home</a>
            </li><li>
                <a href="https://bridge.poly.network/" target="_blank">Poly Bridge</a>
            </li><li>
                <a href="https://explorer.poly.network/" target="_blank">Poly Explorer</a>
            </li>
        </ul>
    </div>

    <div class="book-summary">
        <!--<div class="book-summary-title">文档目录</div>-->
        
        
        <nav role="navigation">
            


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Development</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Joining the Cross Chain Ecosystem
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1.1" data-path="contracts.html">
            
                <a href="contracts.html">
            
                    
                    Cross-Chain Smart Contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="registration.html">
            
                <a href="registration.html">
            
                    
                    Chain Registration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="blockdata_verification.html">
            
                <a href="blockdata_verification.html">
            
                    
                    Block Data Verification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="relayer.html">
            
                <a href="relayer.html">
            
                    
                    Relayer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating New Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating Poly Bridge to Websites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Core Smart Contract</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../Core_Smart_Contract/">
            
                <a href="../Core_Smart_Contract/">
            
                    
                    Main Net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../Core_Smart_Contract/README_TestNet.html">
            
                <a href="../Core_Smart_Contract/README_TestNet.html">
            
                    
                    Contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../Core_Smart_Contract/README_DevNet.html">
            
                <a href="../Core_Smart_Contract/README_DevNet.html">
            
                    
                    Contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../Core_Smart_Contract/Zion_dev_contracts.html">
            
                <a href="../Core_Smart_Contract/Zion_dev_contracts.html">
            
                    
                    Contract
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Glossary</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">FAQ</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


        </nav>
        
        
    </div>

    <!-- Content nav -->
    <div class="book-anchor">
        <!--<div class="book-anchor-title">在这篇文章中:</div>-->
        <div class="book-anchor-body">

        </div>
    </div>

    <div class="book-body">
        
        <div class="body-inner">
            
            

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Cross-Chain Smart Contract</a>
    </h1>
</div>




            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    
<div id="book-search-results">
    <div class="search-noresults">
    
                    <section class="normal markdown-section">
                        
                        <h1 align="center" id="calling-cross-chain-manager-contrat">Calling Cross Chain Manager Contrat</h1>

<p>This Branch is intended for developers who want to develop your own business logic contract which interacted with the cross chain manager provided by Poly Network. </p>
<p>This part introduces the contracts involved in the cross chain process and the interfaces interacted with business logic contract. Business logic serves as smart contract invoked by users both on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. Cross Chain Manager contract offers two interfaces to interact with business logic contract directly. In additionally, an example of business logic is offered to help understand the interaction more vividly.</p>
<h2 id="introduction">Introduction</h2>
<p>Poly cross chain ecosystem provides a platform for various different chains to interact and transfer data along with carrying out cross chain transactions. Any chain can freely join the ecosystem. However, the chains that support smart contracts can interact and transfer all kinds of information between chains, while the chains that do not support smart contracts are limited to cross chain asset transfer. This part will introduce the contracts involved in the cross chain process and how they interact with each other.</p>
<h4 id="list-of-contracts">List of Contracts</h4>
<ul>
<li><strong>Block header synchronization contract</strong>: This contract maintains the record of block headers of the relay chain on this chain. These block headers serve as means to verify cross chain transactions. In the following context, it may be referred to as Header Sync Contract.</li>
<li><strong>Cross chain management contract</strong>: Every chain can have no more than one management contract. It creates the cross chain transactions that are transferred to the relay chain. All the service contracts that contain the business logic need to communicate with the management contract. In the following context, it may be referred to as CCM Contract.</li>
<li><strong>Service contract</strong>: It serves as business logic contract invoked by users both on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. This document offers an example of it, which is named as <code>LockProxy</code> Contract in the part <a href="Example.md">Example</a>.</li>
</ul>
<h4 id="cross-chain-interaction">Cross Chain Interaction</h4>
<p>In general, in a full cross chain process, the user sends a cross chain request to the service contract on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> by invoking a dApp&apos;s cross chain interface, and on the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> the dApp&apos;s smart contract executes the necessary logic to produce the final result. <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> implement the two contracts (Header Sync Contract &amp; CCM Contract) and other necessary interfaces, and anyone can develop an infrastructure for dApps around the CCM Contract. The contracts deployed on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> make up a complete cross chain dApp.</p>
<h2 id="interfaces">Interfaces</h2>
<p>To implement cross chain features for any chain, cross chain management contract is needed to be deployed. Every chain can have no more than one management contract. On <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, it creates the cross chain transactions that are transferred to the Poly; On <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, it verifies the legitimacy of transactions and executes the method on target business logic contract. All the business logic smart contract need to communicate with the management contract. Following are the detailed description of two interfaces which interacts with the business logic contracts.</p>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param toChainId              The target chain id
 *  @param toAddress              The address in bytes format to receive same amount of tokens in target chain
 *  @param toContract             Target smart contract address in bytes in target block chain
 *  @param txData                 Transaction data for target chain, include toAssetHash, toAddress, amount
 *  @return                       true or false 
*/</span>
<span class="token keyword">function</span> <span class="token function">crossChain</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> toContract<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> method<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> txData<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method creates cross chain transactions, invoked by service contracts when a cross chain function is carried out in the logic contract.</li>
<li>This method constructs the <code>rawParam</code>, which contains transaction hash, <code>msg.sender</code>, <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id, business logic contract to be invoked on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, the target method to be invoked and the serialized transaction data which has been already constructed in business logic contract. </li>
<li>Then put the hash of <code>rawParam</code> into storage, to help provide proof of transaction existence.</li>
</ul>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param proof                  Poly chain transaction merkle proof
 *  @param rawHeader              The header containing crossStateRoot to verify the above tx merkle proof
 *  @param headerProof            The header merkle proof used to verify rawHeader
 *  @param curRawHeader           Any header in current epoch consensus of Poly chain
 *  @param headerSig              The coverted signature veriable for solidity derived from Poly chain consensus nodes&apos; signature 
 *                                used to verify the validity of curRawHeader
 *  @return                       true or false
*/</span>
<span class="token keyword">function</span> <span class="token function">verifyHeaderAndExecuteTx</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> proof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> rawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerProof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> curRawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerSig<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method is meant to be invoked by <a href="../GLOSSARY.html#relayer" class="glossary-term" title="A cross-chain information porter performs some of the most critical operations within the cross-chain. It acts as the medium of interaction between the side chain and the outside world.">relayer</a>, in some cases user could invoke this method by themselves if they get the valid block information from Poly. </li>
<li>This method fetches and processes cross chain transactions, finds the merkle root of a transaction based on the block height (in the block header), verifies the legitimacy of transaction using the transaction parameters.</li>
<li>After verifying <a href="../GLOSSARY.html#poly-chain" class="glossary-term" title="The Relay chain in the cross-chain ecosystem. One of the crucial components of the cross-chain ecosystem. Each type of node is deployed and maintained by other individuals or organizations and has its unique governance and trust mechanism. The relay chain is responsible for connecting them, standardizing cross-chain data flow and interfaces, verifying the legitimacy of cross-chain data, etc.">Poly chain</a> header and proof, it will invoke the service contract on the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. The detailed invoking will be processed as <code>_executeCrossChainTx</code> method as following: <ul>
<li>This method is meant to invoke the targeting contract, and trigger executation of cross chain tx on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. Firstly, we need to ensure the targeting contract gonna be invoked is indeed a contract rather than a normal account address. </li>
<li>Then we construct a method call on target business logic contract, first we need to <code>encodePacked</code> the <code>_method</code> and the format of input data <code>&quot;(bytes,bytes,uint64)&quot;</code> , then <code>keccak256</code> the encoded string, use <code>bytes4</code> to take the first four bytes of the call data for a function call specifies the function to be called. Parameter <code>_method</code>  is from the <code>toMerkleValue</code> , which is parsed from <code>proof</code>. And the input parameters format is restricted as (bytes <code>_args</code>, bytes <code>_fromContractAddr</code>, uint64 <code>_fromChainId</code>). These two parts are encodePacked as a call.  </li>
<li>After calling the method, we need to check that if the return value is true. Only if the return value is true, will the whole cross chain transaction be executed successfully. </li>
</ul>
</li>
</ul>
<p>You may refer to the full <a href="https://github.com/polynetwork/eth-contracts/blob/master/contracts/core/cross_chain_manager/logic/EthCrossChainManager.sol" target="_blank">code</a> of <code>EthCrossChainManager</code> contract. </p>
<h2 id="example">Example</h2>
<p>This part provides an example of business logic contract, which provides a method to cross-chain transfer assets between two chains where already equipped with Cross-Chain Manager Contract and other required contracts mentioned before. In this example, the business logic contract is named as <code>LockProxy</code> contract.</p>
<h4 id="authority-management">Authority Management:</h4>
<p>To ensure the security and integrity of the methods in contract, developers of business logic contracts need to manage the authority of invoking the methods. Here we provider a modifier which could modify the authority of these methods.</p>
<pre class="language-"><code class="lang-solidity"><span class="token comment">// ethCCMProxyAddr: the address of cross chain manager proxy contract</span>
<span class="token keyword">function</span> <span class="token function">setManagerProxy</span><span class="token punctuation">(</span><span class="token builtin">address</span> ethCCMProxyAddr<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token punctuation">{</span>
    managerProxyContract <span class="token operator">=</span> ethCCMProxyAddr<span class="token punctuation">;</span>
    <span class="token keyword">emit</span> <span class="token function">SetManagerProxyEvent</span><span class="token punctuation">(</span>managerProxyContract<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">modifier</span> <span class="token function">onlyManagerContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    IEthCrossChainManagerProxy ieccmp <span class="token operator">=</span> <span class="token function">IEthCrossChainManagerProxy</span><span class="token punctuation">(</span>managerProxyContract<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">_msgSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ieccmp<span class="token punctuation">.</span><span class="token function">getEthCrossChainManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;msgSender is not EthCrossChainManagerContract&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">_</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Setting the manager contract and binding assets/chains pair should be stricted to only the owner of <code>LockProxy</code> contract.</li>
<li>Releasing the assets on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> should also be stricted to only the cross chain manager contract. </li>
</ul>
<h4 id="bind-assets">Bind assets:</h4>
<p>Besides of the verifying the existence of transaction through CCM contract, <code>LockProxy</code> contract needs to make sure of the accuracy of the assets relationship in the transaction. Therefore, the business contract should maintain the asset mapping and CCM proxy contract mapping. Asset mapping is from the asset on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> to the mapping of <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id to the same kind of asset issued on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. CCM contract mapping is from the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id to the <code>LockProxy</code> contract address on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>.</p>
<p>The asset mapping relationship which stored in <code>LockProxy</code> contract will help provide the completeness of transaction data. Bind actions also prevent the wrong input from users which may lead to transfer assets to wrong asset contract address.</p>
<pre class="language-"><code class="lang-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.5.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./../../libs/ownership/Ownable.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">LockProxy</span> <span class="token keyword">is</span> Ownable <span class="token punctuation">{</span>
    <span class="token builtin">address</span> <span class="token keyword">public</span> managerProxyContract<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> <span class="token operator">=&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token keyword">public</span> proxyHashMap<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> <span class="token operator">=&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">public</span> assetHashMap<span class="token punctuation">;</span>

    <span class="token comment">// toChainId: the target chain id</span>
    <span class="token comment">// targetProxyHash: the address of lock proxy contract on target chain</span>
    <span class="token keyword">function</span> <span class="token function">bindProxyHash</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> targetProxyHash<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        proxyHashMap<span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span> <span class="token operator">=</span> targetProxyHash<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">BindProxyEvent</span><span class="token punctuation">(</span>toChainId<span class="token punctuation">,</span> targetProxyHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// fromAssetHash: asset hash on source chain </span>
    <span class="token comment">// toAssetHash: asset hash on target chain</span>
    <span class="token keyword">function</span> <span class="token function">bindAssetHash</span><span class="token punctuation">(</span><span class="token builtin">address</span> fromAssetHash<span class="token punctuation">,</span> <span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAssetHash<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        assetHashMap<span class="token punctuation">[</span>fromAssetHash<span class="token punctuation">]</span><span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span> <span class="token operator">=</span> toAssetHash<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">BindAssetEvent</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> toChainId<span class="token punctuation">,</span> toAssetHash<span class="token punctuation">,</span> <span class="token function">getBalanceFor</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>After setting the CCM proxy contract, the two mapping relationships should be input through <code>bindProxyHash()</code> and <code>bindAssetHash()</code>.</li>
<li><p>Both on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, the user needs to bind the asset hash and <code>LockProxy</code> contract, so that the <code>LockProxy</code> contract can maintain mappings: </p>
<ul>
<li>From asset contract address on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and that on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> with <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id.</li>
<li>From <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id to  <code>LockProxy</code> contract address on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a></li>
</ul>
</li>
<li><p>After finishing setting all above,  <code>LockProxy</code> contract will work properly as the business logic. </p>
</li>
</ul>
<h4 id="cross-chain-transaction">Cross-Chain transaction:</h4>
<p>One cross chain transaction can be divided into two parts: on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>,  <code>LockProxy</code> contract will lock the asset to contract; on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>,  <code>LockProxy</code> contract will unlock the same amount to the target address. The whole process needs to convey the transaction data. The relationships between two chain&apos;s transaction data parameters shows below:</p>
<div align="center"><a href="resources/dataflow.jpeg" data-lightbox="4a47bf41-dc49-4d09-af61-adecdf945cab" data-title=""><img src="resources/dataflow.jpeg" alt=""></a></div>

<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param fromAssetHash     The asset address in current chain
 *  @param toChainId         The target chain id
 *  @param toAddress         The address in bytes format to receive same amount of tokens in target chain 
 *  @param amount            The amount of tokens to be crossed from ethereum to the chain with chainId
*/</span>
<span class="token keyword">function</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token builtin">address</span> fromAssetHash<span class="token punctuation">,</span> <span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAddress<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>amount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;amount cannot be zero!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">_transferToContract</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer asset from fromAddress to lock_proxy contract failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAssetHash <span class="token operator">=</span> assetHashMap<span class="token punctuation">[</span>fromAssetHash<span class="token punctuation">]</span><span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;empty illegal toAssetHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    TxArgs <span class="token keyword">memory</span> txArgs <span class="token operator">=</span> <span class="token function">TxArgs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        toAssetHash<span class="token punctuation">:</span> toAssetHash<span class="token punctuation">,</span>
        toAddress<span class="token punctuation">:</span> toAddress<span class="token punctuation">,</span>
        amount<span class="token punctuation">:</span> amount
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> txData <span class="token operator">=</span> <span class="token function">_serializeTxArgs</span><span class="token punctuation">(</span>txArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    IEthCrossChainManagerProxy eccmp <span class="token operator">=</span> <span class="token function">IEthCrossChainManagerProxy</span><span class="token punctuation">(</span>managerProxyContract<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> eccmAddr <span class="token operator">=</span> eccmp<span class="token punctuation">.</span><span class="token function">getEthCrossChainManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IEthCrossChainManager eccm <span class="token operator">=</span> <span class="token function">IEthCrossChainManager</span><span class="token punctuation">(</span>eccmAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toProxyHash <span class="token operator">=</span> proxyHashMap<span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>toProxyHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;empty illegal toProxyHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>eccm<span class="token punctuation">.</span><span class="token function">crossChain</span><span class="token punctuation">(</span>toChainId<span class="token punctuation">,</span> toProxyHash<span class="token punctuation">,</span> <span class="token string">&quot;unlock&quot;</span><span class="token punctuation">,</span> txData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;EthCrossChainManager crossChain executed error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">emit</span> <span class="token function">LockEvent</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> <span class="token function">_msgSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toChainId<span class="token punctuation">,</span> toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>This function is meant to be invoked by the user, a certain amount tokens will be locked immediately. Then the same amount of tokens will be unlocked from <code>LockProxy</code> contract on the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> with chain id later;</li>
<li>The user makes an asset token cross chain transaction request through the dApp which works in <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, <code>LockProxy</code> contract gets the transation information which contains the asset contract address on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id, the target address and amount of token to be transfered. By calling the function <code>lock()</code>, <code>LockProxy</code> contract will lock(transfer) the certain amount to asset contract;</li>
<li>Then the transaction data will be packed, which then in turn invokes the CCM contract. The management contract transfers the parameters of transaction data to the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and a cross chain transaction is created by management contract which is sent to the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> based on block generation on <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>;</li>
<li>The serialized transaction data, along with the chain id and <code>LockProxy</code> contract address of <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and the method needed to be called on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, will be sent through <code>crossChain()</code> in CCM contract.</li>
</ul>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param argsBs            The argument bytes recevied by the lock proxy contract on source chain, 
 *                           need to be deserialized based on the way of serialization in the 
 *                           lock proxy contract on source chain .
 *  @param fromContractAddr  The source chain contract address
 *  @param fromChainId       The source chain id
*/</span>
<span class="token keyword">function</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> argsBs<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> fromContractAddr<span class="token punctuation">,</span> <span class="token builtin">uint64</span> fromChainId<span class="token punctuation">)</span> onlyManagerContract <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TxArgs <span class="token keyword">memory</span> args <span class="token operator">=</span> <span class="token function">_deserializeTxArgs</span><span class="token punctuation">(</span>argsBs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>fromContractAddr<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;from proxy contract address cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>Utils<span class="token punctuation">.</span><span class="token function">equalStorage</span><span class="token punctuation">(</span>proxyHashMap<span class="token punctuation">[</span>fromChainId<span class="token punctuation">]</span><span class="token punctuation">,</span> fromContractAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;From Proxy contract address error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;toAssetHash cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> toAssetHash <span class="token operator">=</span> Utils<span class="token punctuation">.</span><span class="token function">bytesToAddress</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;toAddress cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> toAddress <span class="token operator">=</span> Utils<span class="token punctuation">.</span><span class="token function">bytesToAddress</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">_transferFromContract</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> args<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer asset from lock_proxy contract to toAddress failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">emit</span> <span class="token function">UnlockEvent</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> args<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>This functions is meant to be invoked by Cross-Chain manager contract. It deserializes the transaction data and invokes the asset contract to release the tokens to target address.</li>
<li>After verification through Poly (detailed verification process shown in part Cross Chain Interaction Between Chains), the packed transaction data could be executed on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>.</li>
<li><code>verifyHeaderAndExecuteTx()</code> in Cross Chain Manager contract determines the legitimacy of the cross chain transaction information and resolve the parameters of transaction data from the <a href="../GLOSSARY.html#poly-chain" class="glossary-term" title="The Relay chain in the cross-chain ecosystem. One of the crucial components of the cross-chain ecosystem. Each type of node is deployed and maintained by other individuals or organizations and has its unique governance and trust mechanism. The relay chain is responsible for connecting them, standardizing cross-chain data flow and interfaces, verifying the legitimacy of cross-chain data, etc.">Poly chain</a> transaction merkle proof and <code>crossStateRoot</code> contained in the block header. </li>
<li>Then call the function <code>unlock()</code> to deserialize the transaction data and unlock (transfer) the certain amount of token to the target address on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and completes the cross chain contract invocation. </li>
</ul>
<h4 id="serialize--deserialize-transaction-data">Serialize &amp; deserialize transaction data</h4>
<pre class="language-"><code class="lang-solidity"><span class="token keyword">function</span> <span class="token function">_serializeTxArgs</span><span class="token punctuation">(</span>TxArgs <span class="token keyword">memory</span> args<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> buff<span class="token punctuation">;</span>
    buff <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>
        ZeroCopySink<span class="token punctuation">.</span><span class="token function">WriteVarBytes</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">)</span><span class="token punctuation">,</span>
        ZeroCopySink<span class="token punctuation">.</span><span class="token function">WriteVarBytes</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">,</span>
        ZeroCopySink<span class="token punctuation">.</span><span class="token function">WriteUint255</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>amount<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> buff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_deserializeTxArgs</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> valueBs<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span>TxArgs <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TxArgs <span class="token keyword">memory</span> args<span class="token punctuation">;</span>
    <span class="token builtin">uint256</span> off <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">,</span> off<span class="token punctuation">)</span> <span class="token operator">=</span> ZeroCopySource<span class="token punctuation">.</span><span class="token function">NextVarBytes</span><span class="token punctuation">(</span>valueBs<span class="token punctuation">,</span> off<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">,</span> off<span class="token punctuation">)</span> <span class="token operator">=</span> ZeroCopySource<span class="token punctuation">.</span><span class="token function">NextVarBytes</span><span class="token punctuation">(</span>valueBs<span class="token punctuation">,</span> off<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span>args<span class="token punctuation">.</span>amount<span class="token punctuation">,</span> off<span class="token punctuation">)</span> <span class="token operator">=</span> ZeroCopySource<span class="token punctuation">.</span><span class="token function">NextUint255</span><span class="token punctuation">(</span>valueBs<span class="token punctuation">,</span> off<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> args<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>In the process of contract development, developers will always encounter serialization and deserialization problems, that is, how to save a struct type of data in the database and how to deserialize the byte array read from the database to obtain data of struct type. In the libs, <code>ZeroCopySource.sol</code> and <code>ZeroCopySink.sol</code> offered the interfaces to serialize and deserialize data. </li>
<li>When serializing various data types, for fixed-length data (for example: <code>bytes</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, etc.), directly convert the data into a byte array; for data with variable length, serializing the length is required firstly, and then serialize the data (for example, unsigned integers of unknown size, including <code>uint16</code>, <code>uint32</code>, or <code>uint64</code>, etc.).</li>
<li>Deserialization is the opposite of serialization. For all serialization methods, there are corresponding deserialization methods. When reading data of a specified type, if you know its length, you can read it directly; for data with an unknown length, read the length first, and then read the content. </li>
</ul>
<p>You may refer to the full <a href="https://github.com/polynetwork/eth-contracts/blob/master/contracts/core/lock_proxy/LockProxy.sol" target="_blank">code</a> of <code>LockProxy</code> contract . </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; 2022 PolyNetwork. All right reserved.</span><span class="footer-modification">Last modification date&#xFF1A;
2022-01-18 15:52:36
</span></footer>
                        
                    </section>
                    
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                </div>
            </div>
            
        </div>

        
        
        <a href="readme.html"
           class="navigation navigation-prev "
           aria-label="Previous page: Joining the Cross Chain Ecosystem">
            <i class="fa fa-angle-left"></i>
        </a>
        
        
        <a href="registration.html"
           class="navigation navigation-next "
           aria-label="Next page: Chain Registration">
            <i class="fa fa-angle-right"></i>
        </a>
        
        
        
    </div>
    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Cross-Chain Smart Contract","level":"2.1.1","depth":2,"next":{"title":"Chain Registration","level":"2.1.2","depth":2,"path":"add_chain/registration.md","ref":"add_chain/registration.md","articles":[]},"previous":{"title":"Joining the Cross Chain Ecosystem","level":"2.1","depth":1,"path":"add_chain/readme.md","ref":"add_chain/readme.md","articles":[{"title":"Cross-Chain Smart Contract","level":"2.1.1","depth":2,"path":"add_chain/contracts.md","ref":"add_chain/contracts.md","articles":[]},{"title":"Chain Registration","level":"2.1.2","depth":2,"path":"add_chain/registration.md","ref":"add_chain/registration.md","articles":[]},{"title":"Block Data Verification","level":"2.1.3","depth":2,"path":"add_chain/blockdata_verification.md","ref":"add_chain/blockdata_verification.md","articles":[]},{"title":"Relayer","level":"2.1.4","depth":2,"path":"add_chain/relayer.md","ref":"add_chain/relayer.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["theme-hqbook","flexible-linkcard","emphasize","flexible-alerts","lightbox","alerts","expandable-chapters","custom-favicon","tbfed-pagefooter","hide-element","-lunr","-search","search-pro","github","code","heading-anchors","-highlight","prism","prism-themes","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy 2022 PolyNetwork.","modify_label":"Last modification date：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"emphasize":{},"github":{"url":"https://github.com/polynetwork"},"livereload":{},"search-pro":{},"flexible-linkcard":{"hrefUrl":"../../demo/demo.html","imgClass":"","imgSrc":"../../images/home/logo.png","target":"_blank","title":"Converts blockquotes into beautiful linkcard, custom nice links"},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"favicon":"resources/favicon.ico","lightbox":{"jquery":true,"sameUuid":false},"prism-themes":{},"theme-hqbook":{"copyButtons":false,"copyLines":true,"dragSplitter":true,"favicon":"./favicon.ico","flexible-linkcard":{"hrefUrl":"../../demo/demo.html","imgClass":"","imgSrc":"../../images/home/logo.png","target":"_blank","title":"Converts blockquotes into beautiful linkcard, custom nice links"},"logo":"/resources/logo.png","search-placeholder":"Search...","hide-elements":[".summary .gitbook-link"]},"alerts":{},"custom-favicon":{},"flexible-alerts":{"danger":{"className":"danger","icon":"fa fa-ban","label":"Attention"},"note":{"className":"info","icon":"fa fa-info-circle","label":"Note"},"style":"callout","tip":{"className":"tip","icon":"fa fa-lightbulb-o","label":"Tip"},"warning":{"className":"warning","icon":"fa fa-exclamation-triangle","label":"Warning"}},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"lightbox":{"includeJQuery":false,"sameUuid":true,"options":{"resizeDuration":500,"wrapAround":false}},"variables":{"themeHqbook":{"nav":[{"url":"https://poly.network/","target":"_blank","name":"Home"},{"url":"https://bridge.poly.network/","target":"_blank","name":"Poly Bridge"},{"url":"https://explorer.poly.network/","target":"_blank","name":"Poly Explorer"}]}},"title":"","flexible-alerts":{"style":"callout","comment":{"label":"Comment","icon":"fa fa-comments","className":"info"}},"gitbook":"*","theme-default":{"showLevel":true}},"file":{"path":"add_chain/contracts.md","mtime":"2022-01-18T07:52:36.971Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-20T09:55:48.647Z"},"basePath":"..","book":{"language":""}})
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-flexible-linkcard/flexible-linkcard.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-alerts/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-hqbook/theme.js"></script>
        
    

    </body>
</html>

