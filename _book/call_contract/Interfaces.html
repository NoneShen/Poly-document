
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Interfaces Offered by Cross Chain Manager · Gitbook Test</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Example.html" />
    
    
    <link rel="prev" href="Interaction.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Development</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../add_chain/readme.html">
            
                <a href="../add_chain/readme.html">
            
                    
                    Joing the Cross Chain Ecosystem
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../add_chain/scenario.html">
            
                <a href="../add_chain/scenario.html">
            
                    
                    Two Scenarios
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../add_chain/elements.html">
            
                <a href="../add_chain/elements.html">
            
                    
                    Essential Elements for Header Sync
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../add_chain/steps.html">
            
                <a href="../add_chain/steps.html">
            
                    
                    Common Steps for Header Sync
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../add_chain/guideline.html">
            
                <a href="../add_chain/guideline.html">
            
                    
                    Develop Guideline for Header Sync
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="./">
            
                <a href="./">
            
                    
                    Calling the Cross Chain Smart Contract
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="Interaction.html">
            
                <a href="Interaction.html">
            
                    
                    Cross Chain Interaction Between Chains
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2.2" data-path="Interfaces.html">
            
                <a href="Interfaces.html">
            
                    
                    Interfaces Offered by Cross Chain Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="Example.html">
            
                <a href="Example.html">
            
                    
                    Example of Business Logic Smart Contract
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating New Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating Poly Bridge to Websites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="../add_chain/template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Glossary</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">FAQ</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Default header1
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Interfaces Offered by Cross Chain Manager</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#interfaces-offered-by-cross-chain-manager"><b></b>Interfaces Offered by Cross Chain Manager</a></li></ul></div><a href="#interfaces-offered-by-cross-chain-manager" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 align="center" id="interfaces-offered-by-cross-chain-manager"><a name="interfaces-offered-by-cross-chain-manager" class="anchor-navigation-ex-anchor" href="#interfaces-offered-by-cross-chain-manager"><i class="fa fa-link" aria-hidden="true"></i></a>Interfaces Offered by Cross Chain Manager</h1>

<p>To implement cross chain features for any chain, cross chain management contract is needed to be deployed. Every chain can have no more than one management contract. On <a href="../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, it creates the cross chain transactions that are transferred to the Poly; On <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, it verifies the legitimacy of transactions and executes the method on target business logic contract. All the business logic smart contract need to communicate with the management contract. Following are the detailed description of three interfaces which interacts with the business logic contracts.</p>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  @param toChainId              The target chain id
 *  @param toAddress              The address in bytes format to receive same amount of tokens in target chain
 *  @param toContract             Target smart contract address in bytes in target block chain
 *  @param txData                 Transaction data for target chain, include toAssetHash, toAddress, amount
 *  @return                       true or false 
*/</span>
<span class="token keyword">function</span> <span class="token function">crossChain</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> toContract<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> method<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> txData<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method creates cross chain transactions, invoked by service contracts when a cross chain function is carried out in the logic contract.</li>
<li>This method constructs the <code>rawParam</code>, which contains transaction hash, <code>msg.sender</code>, <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id, business logic contract to be invoked on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, the target method to be invoked and the serialized transaction data which has been already constructed in business logic contract. </li>
<li>Then put the hash of <code>rawParam</code> into storage, to help provide proof of transaction existence.</li>
</ul>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  @param proof                  Poly chain transaction merkle proof
 *  @param rawHeader              The header containing crossStateRoot to verify the above tx merkle proof
 *  @param headerProof            The header merkle proof used to verify rawHeader
 *  @param curRawHeader           Any header in current epoch consensus of Poly chain
 *  @param headerSig              The coverted signature veriable for solidity derived from Poly chain consensus nodes&apos; signature 
 *                                used to verify the validity of curRawHeader
 *  @return                       true or false
*/</span>
<span class="token keyword">function</span> <span class="token function">verifyHeaderAndExecuteTx</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> proof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> rawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerProof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> curRawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerSig<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method is meant to be invoked by <a href="../GLOSSARY.html#relayer" class="glossary-term" title="A cross-chain information porter performs some of the most critical operations within the cross-chain. It acts as the medium of interaction between the side chain and the outside world.">relayer</a>, in some cases user could invoke this method by themselves if they get the valid block information from Poly. </li>
<li>This method fetches and processes cross chain transactions, finds the merkle root of a transaction based on the block height (in the block header), verifies the legitimacy of transaction using the transaction parameters.</li>
<li>After verifying <a href="../GLOSSARY.html#poly-chain" class="glossary-term" title="The Relay chain in the cross-chain ecosystem. One of the crucial components of the cross-chain ecosystem. Each type of node is deployed and maintained by other individuals or organizations and has its unique governance and trust mechanism. The relay chain is responsible for connecting them, standardizing cross-chain data flow and interfaces, verifying the legitimacy of cross-chain data, etc.">Poly chain</a> header and proof, it will invoke the service contract on the <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. The detailed invoking will be processed as <code>_executeCrossChainTx</code> method as following.</li>
</ul>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  @param _toContract            The targeting contract that will be invoked by the Ethereum Cross Chain Manager contract
 *  @param _method                At which method will be invoked within the targeting contract
 *  @param _args                  The parameter that will be passed into the targeting contract
 *  @param _fromContractAddr      From chain smart contract address
 *  @param _fromChainId           Indicate from which chain current cross chain tx comes 
 *  @return                       true or false
*/</span>
<span class="token keyword">function</span> <span class="token function">_executeCrossChainTx</span><span class="token punctuation">(</span><span class="token builtin">address</span> _toContract<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> _method<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> _args<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> _fromContractAddr<span class="token punctuation">,</span> <span class="token builtin">uint64</span> _fromChainId<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method is meant to invoke the targeting contract, and trigger executation of cross chain tx on <a href="../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>.</li>
<li>Firstly, we need to ensure the targeting contract gonna be invoked is indeed a contract rather than a normal account address. </li>
<li>Then we construct a method call on target business logic contract, the first four bytes of the call data for a function call specifies the function to be called. Parameter <code>_method</code>  is from the <code>toMerkleValue</code> , which is parsed from <code>proof</code>. And the input parameters format is restricted as (bytes <code>_args</code>, bytes <code>_fromContractAddr</code>, uint64 <code>_fromChainId</code>). These two parts are encodePacked as a call. </li>
<li>After calling the method, we need to check that if the return value is true. Only if the return value is true, will the whole cross chain transaction be executed successfully. </li>
</ul>
<p>You may refer to the full <a href="https://github.com/polynetwork/eth-contracts/blob/master/contracts/core/cross_chain_manager/logic/EthCrossChainManager.sol" target="_blank">code</a> of <code>EthCrossChainManager</code> contract . </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; 2021 PolyNetwork all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">Last modification date&#xFF1A;
2021-12-29 16:37:37
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Interaction.html" class="navigation navigation-prev " aria-label="Previous page: Cross Chain Interaction Between Chains">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Example.html" class="navigation navigation-next " aria-label="Next page: Example of Business Logic Smart Contract">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Interfaces Offered by Cross Chain Manager","level":"2.2.2","depth":2,"next":{"title":"Example of Business Logic Smart Contract","level":"2.2.3","depth":2,"path":"call_contract/Example.md","ref":"call_contract/Example.md","articles":[]},"previous":{"title":"Cross Chain Interaction Between Chains","level":"2.2.1","depth":2,"path":"call_contract/Interaction.md","ref":"call_contract/Interaction.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","custom-favicon","insert-logo","tbfed-pagefooter","hide-element","anchor-navigation-ex","-lunr","-search","search-pro","github","code","heading-anchors","-highlight","prism","prism-themes"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy 2021 PolyNetwork","modify_label":"Last modification date：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"github":{"url":"https://github.com/polynetwork"},"search-pro":{},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-anchor","level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"favicon":"resources/favicon.ico","prism-themes":{},"custom-favicon":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"insert-logo":{"style":"background: none; max-height: 30px; min-height: 30px","url":"/resources/logo.svg"},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Gitbook Test","gitbook":"*","theme-default":{"showLevel":true}},"file":{"path":"call_contract/Interfaces.md","mtime":"2021-12-29T08:37:37.979Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-12-30T06:50:42.216Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

